
{
  "entities": {
    "Tour": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Tour",
      "type": "object",
      "description": "Represents a tour event with details about its date, location, capacity, and requirements.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Tour entity."
        },
        "title": {
          "type": "string",
          "description": "The title or name of the tour."
        },
        "startDate": {
          "type": "string",
          "description": "The start date and time the tour is scheduled to occur.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "The end date and time the tour is scheduled to occur.",
          "format": "date-time"
        },
        "registrationDeadline": {
          "type": "string",
          "description": "The last date and time users can register for the tour.",
          "format": "date-time"
        },
        "location": {
          "type": "string",
          "description": "The geographical location or meeting point for the tour."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the tour, including activities and highlights."
        },
        "participantLimit": {
          "type": "number",
          "description": "The maximum number of participants allowed on the tour."
        },
        "ageGroupId": {
          "type": "string",
          "description": "Reference to AgeGroup this tour is designed for. (Relationship: AgeGroup 1:N Tour)"
        },
        "leaderId": {
          "type": "string",
          "description": "Reference to User who is leading the tour. (Relationship: User 1:N Tour)"
        },
        "duration": {
          "type": "string",
          "description": "The estimated duration of the tour (e.g., '3 hours', '2 days')."
        },
        "elevationGain": {
          "type": "number",
          "description": "The total elevation gain in meters."
        },
        "fee": {
          "type": "number",
          "description": "The participation fee for the tour."
        }
      },
      "required": [
        "id",
        "title",
        "startDate",
        "endDate",
        "registrationDeadline",
        "location",
        "description",
        "participantLimit",
        "ageGroupId",
        "leaderId",
        "duration",
        "elevationGain",
        "fee"
      ]
    },
    "Material": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Material",
      "type": "object",
      "description": "Represents equipment or supplies needed for a tour, including availability and reservation details.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Material entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the material or equipment."
        },
        "description": {
          "type": "string",
          "description": "A description of the material, including its purpose and usage."
        },
        "quantityAvailable": {
          "type": "number",
          "description": "The number of units of this material currently available."
        },
        "price": {
          "type": "number",
          "description": "The price for reserving the material."
        },
        "sizes": {
          "type": "object",
          "description": "A map of available sizes and their respective quantities.",
          "additionalProperties": {
            "type": "number"
          }
        },
        "reservationIds": {
          "type": "array",
          "description": "References to MaterialReservations for this material. (Relationship: Material 1:N MaterialReservation)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "quantityAvailable",
        "price"
      ]
    },
    "MaterialReservation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MaterialReservation",
      "type": "object",
      "description": "Represents a reservation of materials for a specific user and tour.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the MaterialReservation entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User who made the reservation. (Relationship: User 1:N MaterialReservation)"
        },
        "materialId": {
          "type": "string",
          "description": "Reference to Material being reserved. (Relationship: Material 1:N MaterialReservation)"
        },
        "quantityReserved": {
          "type": "number",
          "description": "The quantity of the material reserved."
        },
        "reservationDate": {
          "type": "string",
          "description": "The date and time the reservation was made.",
          "format": "date-time"
        },
        "startDate": {
            "type": "string",
            "description": "The start date for the material reservation period.",
            "format": "date-time"
        },
        "endDate": {
            "type": "string",
            "description": "The end date for the material reservation period.",
            "format": "date-time"
        },
        "status": {
            "type": "string",
            "description": "The current status of the reservation.",
            "enum": ["pending", "approved", "rejected"]
        }
      },
      "required": [
        "id",
        "userId",
        "materialId",
        "quantityReserved",
        "reservationDate",
        "startDate",
        "endDate",
        "status"
      ]
    },
    "AgeGroup": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AgeGroup",
      "type": "object",
      "description": "Represents an age group that tours can be designed for.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AgeGroup entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the age group (e.g., 'Youth', 'Adults')."
        },
        "minAge": {
          "type": "number",
          "description": "The minimum age for this group."
        },
        "maxAge": {
          "type": "number",
          "description": "The maximum age for this group."
        }
      },
      "required": [
        "id",
        "name",
        "minAge",
        "maxAge"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account, storing personal information and preferences.  Note: Does NOT store authentication-related data (passwords, etc.).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity. This should match the Firebase Auth UID."
        },
        "name": {
          "type": "string",
          "description": "The user's display name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The user's role in the application.",
          "enum": [
            "user",
            "admin"
          ]
        },
        "profilePictureUrl": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "role"
      ]
    },
    "Participant": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Participant",
      "type": "object",
      "description": "Represents a user who has signed up for a tour.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The UID of the user who is participating."
        },
        "tourId": {
          "type": "string",
          "description": "The ID of the tour they are participating in."
        },
        "joinedAt": {
          "type": "string",
          "description": "The date and time the user joined the tour.",
          "format": "date-time"
        }
      },
      "required": [
        "userId",
        "tourId",
        "joinedAt"
      ]
    },
    "Post": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Post",
      "type": "object",
      "description": "Represents a sticky note post on the news board.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Post entity."
        },
        "content": {
          "type": "string",
          "description": "The text content of the sticky note."
        },
        "authorId": {
          "type": "string",
          "description": "The UID of the user who created the post."
        },
        "authorName": {
          "type": "string",
          "description": "The display name of the user who created the post."
        },
        "color": {
          "type": "string",
          "description": "The background color of the sticky note."
        },
        "createdAt": {
          "type": "string",
          "description": "The date and time the post was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "content",
        "authorId",
        "authorName",
        "color",
        "createdAt"
      ]
    },
    "Comment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Comment",
      "type": "object",
      "description": "Represents a comment on a post.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Comment entity."
        },
        "postId": {
          "type": "string",
          "description": "The ID of the post this comment belongs to."
        },
        "content": {
          "type": "string",
          "description": "The text content of the comment."
        },
        "authorId": {
          "type": "string",
          "description": "The UID of the user who created the comment."
        },
        "authorName": {
          "type": "string",
          "description": "The display name of the user who created the comment."
        },
        "createdAt": {
          "type": "string",
          "description": "The date and time the comment was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "postId",
        "content",
        "authorId",
        "authorName",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/tours/{tourId}",
        "definition": {
          "entityName": "Tour",
          "schema": {
            "$ref": "#/backend/entities/Tour"
          },
          "description": "Stores information about tours. The 'tourId' parameter uniquely identifies each tour.",
          "params": [
            {
              "name": "tourId",
              "description": "Unique identifier for the tour."
            }
          ]
        }
      },
      {
        "path": "/tours/{tourId}/participants/{userId}",
        "definition": {
          "entityName": "Participant",
          "schema": {
            "$ref": "#/backend/entities/Participant"
          },
          "description": "Stores participants for a specific tour. The document ID is the user's UID.",
          "params": [
            {
              "name": "tourId",
              "description": "Unique identifier for the tour."
            },
            {
              "name": "userId",
              "description": "The UID of the participating user."
            }
          ]
        }
      },
      {
        "path": "/materials/{materialId}",
        "definition": {
          "entityName": "Material",
          "schema": {
            "$ref": "#/backend/entities/Material"
          },
          "description": "Stores information about the materials needed for tours. The 'materialId' parameter uniquely identifies each material.",
          "params": [
            {
              "name": "materialId",
              "description": "Unique identifier for the material."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user information. The 'userId' parameter uniquely identifies each user.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/ageGroups/{ageGroupId}",
        "definition": {
          "entityName": "AgeGroup",
          "schema": {
            "$ref": "#/backend/entities/AgeGroup"
          },
          "description": "Stores information about age groups for tours. The 'ageGroupId' parameter uniquely identifies each age group.",
          "params": [
            {
              "name": "ageGroupId",
              "description": "Unique identifier for the age group."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/materialReservations/{materialReservationId}",
        "definition": {
          "entityName": "MaterialReservation",
          "schema": {
            "$ref": "#/backend/entities/MaterialReservation"
          },
          "description": "Stores material reservations for a specific user. This is the primary path for writes.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "materialReservationId",
              "description": "Unique identifier for the material reservation."
            }
          ]
        }
      },
       {
        "path": "/posts/{postId}",
        "definition": {
          "entityName": "Post",
          "schema": {
            "$ref": "#/backend/entities/Post"
          },
          "description": "Stores sticky note posts. The 'postId' parameter uniquely identifies each post.",
          "params": [
            {
              "name": "postId",
              "description": "Unique identifier for the post."
            }
          ]
        }
      },
      {
        "path": "/posts/{postId}/comments/{commentId}",
        "definition": {
          "entityName": "Comment",
          "schema": {
            "$ref": "#/backend/entities/Comment"
          },
          "description": "Stores comments for a specific post. The 'commentId' parameter uniquely identifies each comment.",
          "params": [
            {
              "name": "postId",
              "description": "Unique identifier for the post."
            },
            {
              "name": "commentId",
              "description": "Unique identifier for the comment."
            }
          ]
        }
      },
      {
        "path": "/materialReservations/{materialReservationId}",
        "definition": {
          "isCollectionGroup": true,
          "entityName": "MaterialReservation",
          "schema": {
            "$ref": "#/backend/entities/MaterialReservation"
          },
          "description": "A collection group query path for all material reservations. This allows admins to query across all subcollections.",
          "params": [
            {
              "name": "materialReservationId",
              "description": "Unique identifier for the material reservation."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to efficiently manage tour-related data, material reservations, age groups, and user information for the 'Alpine Connect' application. To ensure security and scalability, I will create root-level collections for `tours`, `materials`, `ageGroups`, `users`, and `posts`. `MaterialReservation` will be a subcollection of `/users/{userId}` to enforce ownership and allow users to see all their reservations easily. `Comment` is a subcollection of `posts`. I am also defining a collection group for `materialReservations` to allow admins to query across all reservations for the Gear Management page.\n\nThis design promotes Authorization Independence. For example, `MaterialReservation` documents contain the `userId`, avoiding the need to fetch parent document data for authorization.\n\nThe structure also supports the required QAPs. `list` operations can be secured at each collection level. Segregation of concerns allows specific rules for each collection (e.g., only admins can create tours, users can only create reservations for themselves)."
  }
}

    